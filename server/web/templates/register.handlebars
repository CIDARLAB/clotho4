{{>nav}}
<section class="hero">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">Register</h1>
        </div>
        <div class="field">
            <form id="register">
                <label class="label" id="nameLabel"><b>Full Name</b></label>
                <input class="input" id="name" type="text" placeholder="First Last" name="name">
                <label class="label" id="emailLabel"><b>Email</b></label>
                <input class="input" id="email" type="text" placeholder="Email" name="email">
                <label class="label" id="usernameLabel"><b>Username</b></label>
                <input class="input" id="username" type="text" placeholder="Username" name="username">
                <label class="label" id="passwordLabel"><b>Password</b></label>
                <input class="input" id="password" type="text" placeholder="Password" name="password">
                <label class="label" id="retypePwLabel"><b>Retype Password</b></label>
                <input class="input" id="retypePw" type="text" placeholder="Password" name="retypePw">
                <input class="button is-primary" id="submit" type="submit" value="Submit">
            </form>
            <script>
                $('#register').on('submit', function (e) {
                  e.preventDefault();

                  var name = $('#name');
                  var username = $('#username');
                  var password = $('#password');
                  var email = $('#email');
                  var retypePw = $('#retypePw');
                  var valid = false;

                  var fields = [name, email, username, password, retypePw];
                  for(var i = 0; i < fields.length; i++) {  // Loop through the fields and remove the red outline if there is one
                    fields[i].removeClass('is-danger');
                  }

                  // Loop through fields to see if they are filled.
                  for(var i = 0; i < fields.length; i++){
                    if(fields[i][0].value === '') {
                      alert('Please fill out the ' + fields[i][0].id);
                      fields[i].addClass('is-danger');
                      break;
                    }
                    if(i === 4) {   // If they are all filled out, check to see if passwords match
                      if(fields[3][0].value != fields[4][0].value) {
                        alert('Your passwords do not match');
                        fields[3].addClass('is-danger');
                        fields[4].addClass('is-danger');
                        break;
                      }
                      valid = true; // If passwords match, send the data over to the sever.
                    }
                  }

                  if(valid === true) {
                    var values = {};    // Stores the values of the input fields
                    $.each($('#register').serializeArray(), function (i, field) {   // Loops through the input fields
                      values[field.name] = field.value;
                    });
                    delete values.retypePw; //delete the confirmed password

                    // If user does not already exist, send to home page
                    // If any error, show it in an alert
                    $.post('../../api/signup', values, function () {
                      window.location.replace('/');
                    }).fail(function (data) {
                      var message = data.responseJSON.message;
                      message = message.substring(message.lastIndexOf('[')+1, message.lastIndexOf(']'));
                      message = message.replace(/\"/g , "");
                      alert(message)
                    });
                  }
                });

            </script>
        </div>
    </div>
</section>
